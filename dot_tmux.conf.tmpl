# Keybinds
# Easy reload
unbind r
bind r source ~/.tmux.conf 

# use C-a instead of C-b
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Switch windows, and update statusbar
# (makes CWD indicator update almost-instantly)
bind-key -n M-C-n \
previous-window \; run-shell "~/.tmux/plugins/rat_scripts/statusbar.sh"
bind-key -n C-S-Left \
previous-window \; run-shell "~/.tmux/plugins/rat_scripts/statusbar.sh"
# doesn't get reset, for scripts
bind-key -n F9 \
previous-window \; run-shell "~/.tmux/plugins/rat_scripts/statusbar.sh"

bind-key -n M-C-o \
next-window \; run-shell "~/.tmux/plugins/rat_scripts/statusbar.sh"
bind-key -n C-S-Right \
next-window \; run-shell "~/.tmux/plugins/rat_scripts/statusbar.sh"
# doesn't get reset, for scripts
bind-key -n F10 \
next-window \; run-shell "~/.tmux/plugins/rat_scripts/statusbar.sh"

# Switch between nested sessions
# welcome back to the outer session, enable the things
bind-key -n S-up \
send-keys F4 \; \
set -qg status-bg brightwhite \; \
bind-key -n M-C-n \
previous-window \; run-shell "~/.tmux/plugins/rat_scripts/statusbar.sh" \; \
bind-key -n C-S-Left \
previous-window \; run-shell "~/.tmux/plugins/rat_scripts/statusbar.sh" \; \
bind-key -n M-C-o \
next-window \; run-shell "~/.tmux/plugins/rat_scripts/statusbar.sh" \; \
bind-key -n C-S-Right \
next-window \; run-shell "~/.tmux/plugins/rat_scripts/statusbar.sh" \; \
set -qg prefix C-a

bind-key -n M-C-i \
send-keys F4 \; \
set -qg status-bg brightwhite \; \
bind-key -n M-C-n \
previous-window \; run-shell "~/.tmux/plugins/rat_scripts/statusbar.sh" \; \
bind-key -n C-S-Left \
previous-window \; run-shell "~/.tmux/plugins/rat_scripts/statusbar.sh" \; \
bind-key -n M-C-o \
next-window \; run-shell "~/.tmux/plugins/rat_scripts/statusbar.sh" \; \
bind-key -n C-S-Right \
next-window \; run-shell "~/.tmux/plugins/rat_scripts/statusbar.sh" \; \
set -qg prefix C-a

# you're beaming into the inner session, so this one should be good
bind-key -n S-down \
send-keys F3 \; \
set -qg status-bg white \; \
unbind -n M-C-n \; \
unbind -n C-S-Left \; \
unbind -n M-C-o \; \
unbind -n C-S-Right \; \
set -qg prefix C-b

bind-key -n M-C-e \
send-keys F3 \; \
set -qg status-bg white \; \
unbind -n M-C-n \; \
unbind -n C-S-Left \; \
unbind -n M-C-o \; \
unbind -n C-S-Right \; \
set -qg prefix C-b

# you got sent this by the outer session, enable the things
bind-key -n F3 \
set -qg status-bg brightwhite \; \
bind-key -n M-C-n \
previous-window \; run-shell "~/.tmux/plugins/rat_scripts/statusbar.sh" \; \
bind-key -n C-S-Left \
previous-window \; run-shell "~/.tmux/plugins/rat_scripts/statusbar.sh" \; \
bind-key -n M-C-o \
next-window \; run-shell "~/.tmux/plugins/rat_scripts/statusbar.sh" \; \
bind-key -n C-S-Right \
next-window \; run-shell "~/.tmux/plugins/rat_scripts/statusbar.sh" \; \
set -qg prefix C-a

# you got sent this by the outer session, disable the things
bind-key -n F4 \
set -qg status-bg white \; \
unbind -n M-C-n \; \
unbind -n C-S-Left \; \
unbind -n M-C-o \; \
unbind -n C-S-Right \; \
set -qg prefix C-b

# Defaults
# Start counting at 1
set -g  base-index 1
setw -g pane-base-index 1

# Make the "choosing which window to switch to" thing have good highlight colour
set-window-option -g mode-style bold

# mouse support, just in case
set-option -g mouse on

# Status bar
set -g  status-position top 
set -g  status-interval 1
set -g  status-bg 'brightwhite'
set -g  status-fg 'black'
set -g  message-style "bg=white"
# Hide list of windows (we show current window only)
set -g window-status-current-format ''
set -g window-status-format ''

set-window-option -g window-status-format "#{?client_prefix,#[fg=brightwhite]#[bg=black],#[fg=black]#[bg=white]} #W "
set-window-option -g window-status-current-format "\
#{?client_prefix,#[fg=brightwhite]#[bg=black],#[fg=brightyellow]#[bg=white]}\
#{?client_prefix,#[fg=black]#[bg=brightwhite],#[fg=black]#[bg=brightyellow]}#W\
#{?client_prefix,#[fg=brightwhite]#[bg=black],#[fg=brightyellow]#[bg=white]}"

# Left side of status bar
set -g  status-left-length '49'
{{ if ne ( trunc 1 .chezmoi.hostname) "S" }}
# You're not a server: get the normal statusbar
# current program | username | cwd
set -g status-format[0] '#[align=left]\
#{?client_prefix,#[fg=brightwhite]#[bg=black],#[fg=black]#[bg=brightyellow]} \
#(echo "$USER" | head -c 5) \
#{?client_prefix,#[fg=brightwhite]#[bg=black],#[fg=black]#[bg=white]} \
#W \
#{?client_prefix,#[fg=white]#[bg=black],#[fg=brightblack]#[bg=white]}\
#(bash ~/.tmux/plugins/rat_scripts/cwd.sh) '
set -ag status-format[0] '#[align=absolute-centre]\
#[fg=black]#[bg=default]\
'
# battery info
# Current power usage
# Time!
set -ag status-format[0] '#[align=right] \
#{?client_prefix,#[fg=brightwhite]#[bg=black],#[fg=black]#[bg=white]} \
#(bash ~/.tmux/plugins/rat_scripts/battery.sh)\
#(bash ~/.tmux/plugins/rat_scripts/watts.sh)\
%I:%M %P '
{{ else }}
# You're a server!
# current program | username | cwd
set -g status-format[0] '#[align=left]\
#{?client_prefix,#[fg=brightwhite]#[bg=black],#[fg=black]#[bg=brightyellow]} \
#(echo "$USER" | head -c 5) \
#{?client_prefix,#[fg=white]#[bg=black],#[fg=brightblack]#[bg=white]} \
#(bash ~/.tmux/plugins/rat_scripts/cwd.sh) \
#{?client_prefix,#[fg=brightwhite]#[bg=black],#[fg=black]#[bg=brightyellow]}\
#[align=absolute-centre]\
#{?client_prefix,#[fg=black]#[bg=brightwhite],#[fg=white]#[bg=brightwhite]}\
#{W:#{E:window-status-format},#{E:window-status-current-format}}\
#{?client_prefix,#[fg=black]#[bg=brightwhite],#[fg=white]#[bg=brightwhite]}'


# uptime
set -ag status-format[0] "#[align=right]\
#{?client_prefix,#[fg=brightwhite]#[bg=black],#[fg=black]#[bg=white]} \
#(uptime | awk \'/days?/ {print $3\"d\"; next}; {print 0}\') "
{{ end }}

# Fix vim not updating straight away when switching modes
set -sg escape-time 10

# Plugin list 
# if i ever want to use them, that is
# set -g  @plugin 'tmux-plugins/tpm'
# thingy what needs to live on the bottom
# run '~/.tmux/plugins/tpm/tpm'
